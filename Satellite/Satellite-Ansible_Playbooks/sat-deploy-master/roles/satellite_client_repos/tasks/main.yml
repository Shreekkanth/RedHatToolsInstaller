- name: set on_demand policy
  command: hammer settings set --name default_download_policy --value on_demand

- name: "Enable RHEL 7 RPMs repositories"
  katello_repository_set:
    username: "{{ foreman_username }}"
    password: "{{ foreman_password }}"
    server_url: "{{ foreman_server_url }}"
    verify_ssl: "{{ foreman_verify_ssl }}"
    name: "Red Hat Enterprise Linux 7 Server (RPMs)"
    organization: "{{ foreman_org }}"
    product: "Red Hat Enterprise Linux Server"
    repositories:
    - releasever: "7Server"
      basearch: "x86_64"
    state: enabled
  become: false
  delegate_to: localhost

- name: "Enable RHEL 7 Satellite 6.3 tools RPMs repositories"
  katello_repository_set:
    username: "{{ foreman_username }}"
    password: "{{ foreman_password }}"
    server_url: "{{ foreman_server_url }}"
    verify_ssl: "{{ foreman_verify_ssl }}"
    name: "{{ item }}"
    organization: "{{ foreman_org }}"
    product: "Red Hat Enterprise Linux Server"
    repositories:
    - basearch: "x86_64"
    state: enabled
  become: false
  delegate_to: localhost
  with_items:
    - "Red Hat Satellite Tools 6.3 (for RHEL 7 Server) (RPMs)"
    - "Red Hat Satellite Tools 6.3 - Puppet 4 (for RHEL 7 Server) (RPMs)"

- name: "Sync repositories"
  katello_sync:
    username: "{{ foreman_username }}"
    password: "{{ foreman_password }}"
    server_url: "{{ foreman_server_url }}"
    verify_ssl: "{{ foreman_verify_ssl }}"
    repository: "{{ item.repo }}"
    product: "{{ item.product }}"
    organization: "{{ foreman_org }}"
  become: false
  delegate_to: localhost
  with_items:
    - product: Red Hat Enterprise Linux Server
      repo: Red Hat Enterprise Linux 7 Server RPMs x86_64 7Server
    - product: Red Hat Enterprise Linux Server
      repo: Red Hat Satellite Tools 6.3 for RHEL 7 Server RPMs x86_64
    - product: Red Hat Enterprise Linux Server
      repo: Red Hat Satellite Tools 6.3 - Puppet 4 for RHEL 7 Server RPMs x86_64
