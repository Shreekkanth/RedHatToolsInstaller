---
- name: Enabel EPEL
  yum:
    name: http://mirror.centos.org/centos/6/os/x86_64/Packages/libffi-devel-3.0.5-3.2.el6.x86_64.rpm
  when: ansible_distribution_major_version == "6"

- name: Install yum packages
  yum: pkg={{ item }} state=present
  with_items:
    - openssl-devel
    - gcc
    - python27
    - python27-python-devel
    - libffi-devel

- name: Install yum packages
  yum: pkg={{ item }} state=present
  with_items:
    - python-devel
    - libffi-devel
    - openssl-devel
    - gcc

- name: Install pip
  easy_install: name=pip

- name: Install virtualenv
  command: pip install virtualenv

- name: Create folder for virtualenv
  file: state=directory owner=root group=root path={{ virtualenv_path }}

- name: Check whether virtualenv exists
  stat: path="{{ virtualenv_path }}/bin/activate"
  register: virtualenv_activate

- name: Create the virtualenv
  command: "scl enable python27 'virtualenv-2.7 {{ virtualenv_path }} --distribute --no-site-packages'"
  when: virtualenv_activate.stat.exists != true

- name: Install requirements
  command: "scl enable python27 '{{ virtualenv_path }}/bin/pip2.7 install -r /root/robottelo/requirements.txt'"
  args:
    chdir: /root/robottelo
