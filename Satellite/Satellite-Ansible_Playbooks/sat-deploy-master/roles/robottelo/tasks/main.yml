---
- name: Clone robottelo
  git: repo=https://github.com/SatelliteQE/robottelo.git dest=/root/robottelo update=yes force=yes version='6.2.z'

- include: virtualenv.yml

- name: Robottelo properties file
  shell: cp robottelo.properties.sample robottelo.properties chdir=/root/robottelo

- name: Set robottelo hostname
  lineinfile: dest=/root/robottelo/robottelo.properties regexp="^hostname=" line="hostname={{ ansible_fqdn }}" state=present backrefs=yes

- name: Set logging
  lineinfile: dest=/root/robottelo/logging.conf regexp="^level=DEBUG" line="level=INFO" state=present backrefs=yes

- name: Run tests
  shell: "scl enable python27 '{{ virtualenv_path }}/bin/py.test --junit-xml=results.xml tests/foreman/endtoend/test_api_endtoend.py'"
  args:
    chdir: /root/robottelo
