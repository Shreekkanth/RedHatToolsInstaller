---
- name: 'Find latest tools product'
  shell: >
    {{ satellite_seeder_hammer }} product info
    --name 'SatTools'
    --organization '{{ satellite_seeder_organization }}'
  register: latest_tools_product
  ignore_errors: True

- name: 'Create latest tools product'
  shell: >
    {{ satellite_seeder_hammer }} product create
    --name 'SatTools'
    --organization '{{ satellite_seeder_organization }}'
  when: '"product not found" in latest_tools_product.stderr'

- name: 'Find latest tools repo'
  shell: >
    {{ satellite_seeder_hammer }} repository info
    --name 'SatTools'
    --organization '{{ satellite_seeder_organization }}'
    --product 'SatTools'
  register: latest_tools_repo
  ignore_errors: True

- name: 'Create latest tools repo'
  shell: >
    {{ satellite_seeder_hammer }} repository create
    --name 'SatTools'
    --organization '{{ satellite_seeder_organization }}'
    --product 'SatTools'
    --publish-via-http 'yes'
    --content-type 'yum'
    --verify-ssl-on-sync 'no'
    --url {{ satellite_seeder_dogfood_tools_url }}

- name: 'Sync latest tools repo'
  shell: >
      {{ satellite_seeder_hammer }} repository synchronize
      --organization '{{ satellite_seeder_organization }}'
      --product 'SatTools'
      --name 'SatTools'

- name: 'Add latest tools repo to RHEL SOE content view'
  shell: >
    {{ satellite_seeder_hammer }} content-view add-repository
    --organization '{{ satellite_seeder_organization }}'
    --repository 'SatTools'
    --name "RHEL 7 SOE"
    --product "SatTools"
