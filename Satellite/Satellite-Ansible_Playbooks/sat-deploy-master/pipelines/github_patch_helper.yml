- set_fact:
    patchfile_name: "{{ repo | regex_replace('/', '-') }}-{{ pr_number }}.patch"

- name: "Download {{ repo }}#{{ pr_number }}"
  get_url:
    url: "https://patch-diff.githubusercontent.com/raw/{{ repo }}/pull/{{ pr_number }}.patch"
    dest: "/tmp/{{ patchfile_name }}"

- name: "Apply {{ repo }}#{{ pr_number }}"
  patch:
    remote_src: yes
    src: "/tmp/{{ patchfile_name }}"
    basedir: "{{ basedir }}"
    strip: 1
