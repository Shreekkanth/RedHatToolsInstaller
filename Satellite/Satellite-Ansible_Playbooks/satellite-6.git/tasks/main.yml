---
# tasks file for satellite-6
## TODO - Install following stuff
#  subscription-manager register --username {{subs-mgr-username }} --password {{subs-mgr-password }}
#  subscription-manager subscribe --pool=8a85f98148751d4301488a1bdcf06f5c  # rhel-7-server-rpms, rhel-server-rhscl-7-rpms
#  subscription-manager subscribe --pool=8a85f98148751d4301488a1bdb4c6f27  # rhel-7-server-satellite-6.0-rpms
#  subscription-manager repos --disable="*"
#  subscription-manager repos --enable rhel-7-server-rpms --enable rhel-server-rhscl-7-rpms --enable rhel-7-server-satellite-6.0-rpms
#  subscription-manager release --set=7Server

- name: register to subscription-manager
  redhat_subscription: state=present username={{subs-mgr-username}} password={{subs-mgr-password}} autosubscribe=true

#  ping -c1 localhost
#  ping -c1 `hostname -s`
#  ping -c1 `hostname -f` # my_system.domain.com


- name: Install katello packages
  yum:  name={{ items }}
        state=latest
  with_items:
        - katello

name: Install other packages
  yum:  name={{ items }}
        state=latest
  with_items:
        - nslookup
        - bind-utils

- name: In satellite
- shell: katello-installer --foreman-admin-username {{ foreman-username }} --foreman-admin-password {{ foreman-password }}


# firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner foreman -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner foreman -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner katello -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner katello -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner root -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv6 filter OUTPUT 0 -o lo -p tcp -m tcp --dport 9200 -m owner --uid-owner root -j ACCEPT && firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 1 -o lo -p tcp -m tcp --dport 9200 -j DROP && firewall-cmd --permanent --direct --add-rule ipv6 filter OUTPUT 1 -o lo -p tcp -m tcp --dport 9200 -j DROP
